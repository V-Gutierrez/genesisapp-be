(() => { "use strict"; var t = { 221: (t, e, n) => { Object.defineProperty(e, "__esModule", { value: !0 }); const r = new (n(524).PrismaClient); e.default = r }, 765: function (t, e, n) { var r = this && this.__awaiter || function (t, e, n, r) { return new (n || (n = Promise))((function (s, i) { function a(t) { try { u(r.next(t)) } catch (t) { i(t) } } function o(t) { try { u(r.throw(t)) } catch (t) { i(t) } } function u(t) { var e; t.done ? s(t.value) : (e = t.value, e instanceof n ? e : new n((function (t) { t(e) }))).then(a, o) } u((r = r.apply(t, e || [])).next()) })) }, s = this && this.__importDefault || function (t) { return t && t.__esModule ? t : { default: t } }; Object.defineProperty(e, "__esModule", { value: !0 }); const i = s(n(349)), a = s(n(506)), o = s(n(221)), u = s(n(721)), c = s(n(142)), d = s(n(344)); e.default = class { constructor(t) { this.app = t, c.default.config(), this.authenticate() } authenticate() { return r(this, void 0, void 0, (function* () { this.app.post("/api/auth", ((t, e) => r(this, void 0, void 0, (function* () { const n = a.default.object().keys({ email: a.default.string().email().required(), password: a.default.string().required() }), r = u.default.validateSchema(n, t.body); try { if (r) e.status(400).json({ error: r }); else { const { email: n, password: r } = t.body, s = yield o.default.user.findFirst({ where: { email: n }, select: { password: !0, email: !0 } }); if (s) if (yield i.default.comparePassword(r, s.password)) { const t = d.default.sign({ email: s.email }, process.env.ACCESS_TOKEN_SECRET, { expiresIn: "12h" }), n = d.default.sign({ email: s.email }, process.env.REFRESH_TOKEN_SECRET, { expiresIn: "30d" }); e.cookie("jwt", n, { httpOnly: !0, maxAge: 2592e6 }), e.status(200).json({ userLoggedIn: !0, accessToken: t }) } else e.sendStatus(401); else e.sendStatus(401) } } catch (t) { e.sendStatus(500) } })))) })) } } }, 717: function (t, e, n) { var r = this && this.__importDefault || function (t) { return t && t.__esModule ? t : { default: t } }; Object.defineProperty(e, "__esModule", { value: !0 }); const s = r(n(860)), i = r(n(142)), a = r(n(344)), o = r(n(582)); e.default = class { constructor(t) { this.app = t, i.default.config(), this.CORS(), this.Logger(), this.app.use(s.default.json()), this.app.use(s.default.urlencoded({ extended: !1 })) } CORS() { this.app.use((0, o.default)({ origin: ["http://localhost:3000", "http://192.168.0.56:3000/", "https://genesisproject-six.vercel.app"] })) } Logger() { this.app.use(((t, e, n) => { console.log(`${t.method} ${t.url} --- Origin: ${t.headers.origin} - ${JSON.stringify(t.headers)}`), n() })) } static JWT(t) { t.use(((t, e, n) => { const r = t.headers.authorization; if (r) { const t = r; a.default.verify(t, process.env.ACCESS_TOKEN_SECRET, ((t, r) => { t ? e.sendStatus(403) : n() })) } else e.sendStatus(401) })) } } }, 226: function (t, e, n) { var r = this && this.__awaiter || function (t, e, n, r) { return new (n || (n = Promise))((function (s, i) { function a(t) { try { u(r.next(t)) } catch (t) { i(t) } } function o(t) { try { u(r.throw(t)) } catch (t) { i(t) } } function u(t) { var e; t.done ? s(t.value) : (e = t.value, e instanceof n ? e : new n((function (t) { t(e) }))).then(a, o) } u((r = r.apply(t, e || [])).next()) })) }, s = this && this.__importDefault || function (t) { return t && t.__esModule ? t : { default: t } }; Object.defineProperty(e, "__esModule", { value: !0 }); const i = s(n(221)); e.default = class { constructor(t) { this.app = t, this.get() } get() { this.app.get("/api/devotionals", ((t, e) => r(this, void 0, void 0, (function* () { try { const t = yield i.default.devotional.findMany(); e.status(200).json(t) } catch (t) { e.sendStatus(500) } })))) } } }, 96: function (t, e, n) { var r = this && this.__awaiter || function (t, e, n, r) { return new (n || (n = Promise))((function (s, i) { function a(t) { try { u(r.next(t)) } catch (t) { i(t) } } function o(t) { try { u(r.throw(t)) } catch (t) { i(t) } } function u(t) { var e; t.done ? s(t.value) : (e = t.value, e instanceof n ? e : new n((function (t) { t(e) }))).then(a, o) } u((r = r.apply(t, e || [])).next()) })) }, s = this && this.__importDefault || function (t) { return t && t.__esModule ? t : { default: t } }; Object.defineProperty(e, "__esModule", { value: !0 }); const i = s(n(221)); e.default = class { constructor(t) { this.app = t, this.getGrowthGroups() } getGrowthGroups() { return r(this, void 0, void 0, (function* () { this.app.get("/api/growthgroups", ((t, e) => r(this, void 0, void 0, (function* () { try { const t = yield i.default.growthGroup.findMany(); e.status(200).json(t) } catch (t) { e.sendStatus(500).json(null) } })))) })) } } }, 575: function (t, e, n) { var r = this && this.__awaiter || function (t, e, n, r) { return new (n || (n = Promise))((function (s, i) { function a(t) { try { u(r.next(t)) } catch (t) { i(t) } } function o(t) { try { u(r.throw(t)) } catch (t) { i(t) } } function u(t) { var e; t.done ? s(t.value) : (e = t.value, e instanceof n ? e : new n((function (t) { t(e) }))).then(a, o) } u((r = r.apply(t, e || [])).next()) })) }, s = this && this.__importDefault || function (t) { return t && t.__esModule ? t : { default: t } }; Object.defineProperty(e, "__esModule", { value: !0 }); const i = s(n(717)), a = s(n(349)), o = s(n(506)), u = s(n(221)), c = s(n(721)); e.default = class { constructor(t) { this.app = t, this.signUp(), i.default.JWT(this.app), this.get() } get() { return r(this, void 0, void 0, (function* () { this.app.get("/api/users/:id", ((t, e) => r(this, void 0, void 0, (function* () { const { id: n } = t.params; try { if (n) { const t = yield u.default.user.findFirst({ where: { id: n }, select: { id: !0, email: !0, name: !0, createdAt: !0, birthdate: !0 } }); t || e.status(404).json({ error: "User not found" }), t && e.status(200).json(t) } else e.status(401).json({ error: "Invalid or missing ID" }) } catch (t) { e.sendStatus(500) } })))) })) } signUp() { return r(this, void 0, void 0, (function* () { this.app.post("/api/users", ((t, e) => r(this, void 0, void 0, (function* () { const n = o.default.object().keys({ email: o.default.string().email().required(), name: o.default.string().required(), phone: o.default.string().required().min(8).max(14), password: o.default.string().min(8), birthdate: o.default.string().required() }), r = c.default.validateSchema(n, t.body); try { if (r) e.status(400).json({ error: r }); else { const { email: n, name: r, password: s, phone: i, birthdate: o } = t.body; yield u.default.user.create({ data: { email: n, name: r, birthdate: new Date(o).toISOString(), password: yield a.default.hashPassword(s), phone: i } }), e.status(201).json({ message: "User created" }) } } catch (t) { "P2002" === t.code ? e.status(409).json({ error: "User already exists" }) : e.status(500).json({ error: "Internal server error" }) } })))) })) } } }, 536: function (t, e, n) { var r = this && this.__importDefault || function (t) { return t && t.__esModule ? t : { default: t } }; Object.defineProperty(e, "__esModule", { value: !0 }); const s = r(n(226)), i = r(n(96)), a = r(n(717)), o = r(n(575)), u = r(n(765)); e.default = class { constructor(t) { this.app = t, new a.default(this.app), new u.default(this.app), new i.default(this.app), new s.default(this.app), new o.default(this.app) } } }, 349: function (t, e, n) { var r = this && this.__createBinding || (Object.create ? function (t, e, n, r) { void 0 === r && (r = n); var s = Object.getOwnPropertyDescriptor(e, n); s && !("get" in s ? !e.__esModule : s.writable || s.configurable) || (s = { enumerable: !0, get: function () { return e[n] } }), Object.defineProperty(t, r, s) } : function (t, e, n, r) { void 0 === r && (r = n), t[r] = e[n] }), s = this && this.__setModuleDefault || (Object.create ? function (t, e) { Object.defineProperty(t, "default", { enumerable: !0, value: e }) } : function (t, e) { t.default = e }), i = this && this.__importStar || function (t) { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var n in t) "default" !== n && Object.prototype.hasOwnProperty.call(t, n) && r(e, t, n); return s(e, t), e }; Object.defineProperty(e, "__esModule", { value: !0 }); const a = i(n(802)); e.default = class { static hashPassword(t) { return a.hash(t, 10) } static comparePassword(t, e) { return a.compare(t, e) } } }, 721: function (t, e, n) { var r = this && this.__createBinding || (Object.create ? function (t, e, n, r) { void 0 === r && (r = n); var s = Object.getOwnPropertyDescriptor(e, n); s && !("get" in s ? !e.__esModule : s.writable || s.configurable) || (s = { enumerable: !0, get: function () { return e[n] } }), Object.defineProperty(t, r, s) } : function (t, e, n, r) { void 0 === r && (r = n), t[r] = e[n] }), s = this && this.__setModuleDefault || (Object.create ? function (t, e) { Object.defineProperty(t, "default", { enumerable: !0, value: e }) } : function (t, e) { t.default = e }), i = this && this.__importStar || function (t) { if (t && t.__esModule) return t; var e = {}; if (null != t) for (var n in t) "default" !== n && Object.prototype.hasOwnProperty.call(t, n) && r(e, t, n); return s(e, t), e }, a = this && this.__importDefault || function (t) { return t && t.__esModule ? t : { default: t } }; Object.defineProperty(e, "__esModule", { value: !0 }); const o = i(n(634)), u = a(n(506)); e.default = class { static validateSchema(t, e) { const { error: n } = u.default.validate(e, t, { abortEarly: !1, convert: !1 }); if (!n || !n.details) return; const r = n.details.map((({ message: t, path: e }) => ({ [e.join(".")]: t }))); return o.mergeAll(r) } } }, 920: function (t, e, n) { var r = this && this.__importDefault || function (t) { return t && t.__esModule ? t : { default: t } }; Object.defineProperty(e, "__esModule", { value: !0 }); const s = r(n(536)), i = r(n(860)); new class { constructor(t = (0, i.default)()) { this.app = t, this.app.listen(process.env.PORT || 5e3, (() => new s.default(t))) } } }, 524: t => { t.exports = require("@prisma/client") }, 802: t => { t.exports = require("bcrypt") }, 582: t => { t.exports = require("cors") }, 142: t => { t.exports = require("dotenv") }, 860: t => { t.exports = require("express") }, 506: t => { t.exports = require("joi") }, 344: t => { t.exports = require("jsonwebtoken") }, 634: t => { t.exports = require("ramda") } }, e = {}; !function n(r) { var s = e[r]; if (void 0 !== s) return s.exports; var i = e[r] = { exports: {} }; return t[r].call(i.exports, i, i.exports, n), i.exports }(920) })()